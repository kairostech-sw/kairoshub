default_config:  
        
#### python scripts extension. Python scripts goes on folder /python_scripts
#python_script:

recorder:
  purge_keep_days: 21
  db_url: sqlite:////config/home-assistant_v2.db

### HA FRONTENDS
frontend:
  themes: !include_dir_merge_named hakairos-configuration/themes

#### HA Custom Events extension 
#### including configuration files
ha-custom-events: !include_dir_merge_named hakairos-configuration/hacustomevents/

#### HA Kafka extension
#### including configuration files
hakafka: !include_dir_merge_named hakairos-configuration/hakafka/

##### hacs integration
hacs:
  token: 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
  
#### input text entities
input_text:
  system_code:
    name: "Identificativo Sistema"
  system_name: 
    name: "Agricola Futura"
  ############################################################
  ################### Serra 8 ################################
  ############################################################  
  s8_window1:
    name: "id"
  s8_window1_name:
    name: "Nome"
  s8_window1_topic:
    name: "Topic"
    initial: "shellies/s8WindowFrontSeaSide1/roller/0/command"
  s8_window2:
    name: "id"
  s8_window2_name:
    name: "Nome"
  s8_window2_topic:
    name: "Topic"
    initial: "shellies/s8WindowFrontMountainSide1/roller/0/command"
  s8_window3:
    name: "id"
  s8_window3_name:
    name: "Nome"
  s8_window3_topic:
    name: "Topic"
    initial: "shellies/s8WindowRightSide1/roller/0/command"
  s8_window4:
    name: "id"
  s8_window4_name:
    name: "Nome"
  s8_window4_topic:
    name: "Topic"
    initial: "shellies/s8WindowLeftSide1/roller/0/command"
  s8_window5:
    name: "id"
  s8_window5_name:
    name: "Nome"
  s8_window5_topic:
    name: "Topic"
    initial: "shellies/s8WindowTop1/roller/0/command"
  s8_window6:
    name: "id"
  s8_window6_name:
    name: "Nome"
  s8_window6_topic:
    name: "Topic"
    initial: "shellies/s8WindowTop2/roller/0/command"
  ############################################################
  ################### Serra 7 ################################
  ############################################################  
  s7_window1:
    name: "id"
  s7_window1_name:
    name: "Nome"
  s7_window1_topic:
    name: "Topic"
    initial: "shellies/s7WindowLeftSide1/roller/0/command"
  s7_window2:
    name: "id"
  s7_window2_name:
    name: "Nome"
  s7_window2_topic:
    name: "Topic"
    initial: "shellies/s7WindowRightSide1/roller/0/command"
  s7_window3:
    name: "id"
  s7_window3_name:
    name: "Nome"
  s7_window3_topic:
    name: "Topic"
    initial: "shellies/s7WindowFrontSeaSideLx1/roller/0/command"
  s7_window4:
    name: "id"
  s7_window4_name:
    name: "Nome"
  s7_window4_topic:
    name: "Topic"
    initial: "shellies/s7WindowFrontSeaSideRx1/roller/0/command"
  s7_window5:
    name: "id"
  s7_window5_name:
    name: "Nome"
  s7_window5_topic:
    name: "Topic"
    initial: "shellies/s7WindowFrontMountainSideLx1/roller/0/command"
  s7_window6:
    name: "id"
  s7_window6_name:
    name: "Nome"
  s7_window6_topic:
    name: "Topic"
    initial: "shellies/s7WindowFrontMountainSideRx1/roller/0/command"
  s7_window7:
    name: "id"
  s7_window7_name:
    name: "Nome"
  s7_window7_topic:
    name: "Topic"
    initial: "shellies/s7WindowTop1/roller/0/command"
  s7_window8:
    name: "id"
  s7_window8_name:
    name: "Nome"
  s7_window8_topic:
    name: "Topic"
    initial: "shellies/s7WindowTop2/roller/0/command"
  s7_window9:
    name: "id"
  s7_window9_name:
    name: "Nome"
  s7_window9_topic:
    name: "Topic"
    initial: "shellies/s7WindowTop3/roller/0/command"
  s7_window10:
    name: "id"
  s7_window10_name:
    name: "Nome"
  s7_window10_topic:
    name: "Topic"
    initial: "shellies/s7WindowTop4/roller/0/command"

##### input number entities
input_number:
  metrics_frequency:
    name: "Frequenza aggiornamento"
    initial: 6
    min: 1
    max: 24
    step: 1
  windows_automation_frequency:
    name: "Frequenza controllo finestre"
    min: 5
    max: 60
    step: 5
  #######################################
  ############# Serra 7 #################
  #######################################
  s7_open_close_time_window_low:
    name: "Tempo apertura / chiusura finestre basse"
    initial: 50
    min: 1
    max: 120
    step: 1
  s7_open_close_time_window_top:
    name: "Tempo apertura / chiusura colmi"
    initial: 105
    min: 1
    max: 120
    step: 1
  s7_open_close_step_window_low:
    min: 1
    max: 100
    step: 1
  s7_open_close_step_window_top:
    min: 1
    max: 100
    step: 1  
  ######### range temperature serra ###################
  s7_temperature_period_1:
    min: 0
    max: 50
    step: 0.5
  s7_temperature_period_2:
    min: 0
    max: 50
    step: 0.5
  s7_temperature_period_3:
    min: 0
    max: 50
    step: 0.5
  s7_temperature_period_4:
    min: 0
    max: 50
    step: 0.5
  ######## posizioni finestre x range temperatura #####################
  s7_window_top_max_open_period_1:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_1:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_2:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_2:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_3:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_3:
    min: 0
    max: 100
    step: 1  
  s7_window_top_max_open_period_4:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_4:
    min: 0
    max: 100
    step: 1
  ######## posizioni finestre x intensità / direzione vento #####################
  s7_window_top_max_open_period_1_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_1_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_1_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_2_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_2_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_2_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_3_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_3_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_3_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_4_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_4_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_4_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_1_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_1_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_1_upwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_2_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_2_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_2_upwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_3_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_3_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_3_upwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_4_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_low_max_open_period_4_downwind_strong:
    min: 0
    max: 100
    step: 1
  s7_window_top_max_open_period_4_upwind_strong:
    min: 0
    max: 100
    step: 1
  ######################################################################
  #######################################################################
  ######################################################################
  #######################################
  ############# Serra 8 #################
  #######################################
  s8_open_close_time_window_low:
    name: "Serra 8 - Tempo apertura / chiusura finestre basse"
    initial: 50
    min: 1
    max: 120
    step: 1
  s8_open_close_time_window_top:
    name: "Serra 8 - Tempo apertura / chiusura colmi"
    initial: 105
    min: 1
    max: 120
    step: 1
  s8_open_close_step_window_low:
    min: 1
    max: 100
    step: 1
  s8_open_close_step_window_top:
    min: 1
    max: 100
    step: 1  
  ######### range temperature serra ###################
  s8_temperature_period_1:
    min: 0
    max: 50
    step: 0.5
  s8_temperature_period_2:
    min: 0
    max: 50
    step: 0.5
  s8_temperature_period_3:
    min: 0
    max: 50
    step: 0.5
  s8_temperature_period_4:
    min: 0
    max: 50
    step: 0.5
  ######## posizioni finestre x range temperatura #####################
  s8_window_top_max_open_period_1:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_1:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_2:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_2:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_3:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_3:
    min: 0
    max: 100
    step: 1  
  s8_window_top_max_open_period_4:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_4:
    min: 0
    max: 100
    step: 1
  ######## posizioni finestre x intensità / direzione vento #####################
  s8_window_top_max_open_period_1_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_1_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_1_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_2_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_2_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_2_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_3_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_3_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_3_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_4_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_4_downwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_4_upwind_moderate:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_1_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_1_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_1_upwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_2_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_2_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_2_upwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_3_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_3_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_3_upwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_4_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_low_max_open_period_4_downwind_strong:
    min: 0
    max: 100
    step: 1
  s8_window_top_max_open_period_4_upwind_strong:
    min: 0
    max: 100
    step: 1
  
  
  s8_window1_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s8_window2_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s8_window3_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s8_window4_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s8_window5_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s8_window6_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window1_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window2_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window3_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window4_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window5_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window6_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window7_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window8_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window9_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1
  s7_window10_position:
    name: "Posizione corrente"
    min: 0
    max: 100
    step: 1  
  
  
  
  ######### range umidità ########################
  s_humidity_level1:
    name: "Umidità alta ( 0 < h < vento moderato)"
    min: 0
    max: 100
    step: 1
  s_humidity_level2:
    name: "Umidità molto alta ( 0 < h < vento moderato)"
    min: 0
    max: 100
    step: 1
  ######### variabili ambientali, valori incrementali sulle finestre #######
  w_wind_level1:
    name: "Vento moderato ( 0 < w < vento moderato)"
    min: 0
    max: 100
    step: 1
  w_wind_level2:
    name: "Vento intenso (w >= vento intenso )"
    min: 0
    max: 100
    step: 1 
  w_uv_level1:
    name: "Uv moderato"
    min: 0
    max: 9
    step: 1
  w_uv_level2:
    name: "Uv Alto"
    min: 0
    max: 9
    step: 1 
  w_rain_level1:
    name: "Pioggia moderata"
    min: 0
    max: 100
    step: 1
  w_rain_level2:
    name: "Pioggia intensa"
    min: 0
    max: 100
    step: 1
  #windows current position
  s7_window_left_side1_position:
    min: 0
    max: 100
  s7_window_right_side1_position:
    min: 0
    max: 100
  s7_window_front_sea_side_lx1_position:
    min: 0
    max: 100
  s7_window_front_sea_side_rx1_position:
    min: 0
    max: 100
  s7_window_front_mountain_side_lx1_position:
    min: 0
    max: 100
  s7_window_front_mountain_side_rx1_position:
    min: 0
    max: 100
  s7_window_top2_position:
    min: 0
    max: 100
  s7_window_top3_position:
    min: 0
    max: 100
  s7_window_top4_position:
    min: 0
    max: 100
  s7_window_top1_position:
    min: 0
    max: 100
  
input_datetime:
  s7_period_1:
    name: Periodo 1
    has_date: false
    has_time: true
  s7_period_2:
    name: Periodo 2
    has_date: false
    has_time: true
  s7_period_3:
    name: Periodo 3
    has_date: false
    has_time: true
  s7_period_4:
    name: Periodo 4
    has_date: false
    has_time: true
  s8_period_1:
    name: Periodo 1
    has_date: false
    has_time: true
  s8_period_2:
    name: Periodo 2
    has_date: false
    has_time: true
  s8_period_3:
    name: Periodo 3
    has_date: false
    has_time: true
  s8_period_4:
    name: Periodo 4
    has_date: false
    has_time: true

input_select:
  s7_downwind:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_upwind:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_downwind:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_upwind:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest    
  s8_window1_type:
    options: 
      - window_top
      - window_low
  s8_window2_type:
    options: 
      - window_top
      - window_low
  s8_window3_type:
    options: 
      - window_top
      - window_low
  s8_window4_type:
    options: 
      - window_top
      - window_low
  s8_window5_type:
    options: 
      - window_top
      - window_low
  s8_window6_type:
    options: 
      - window_top
      - window_low
  s8_window1_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_window2_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_window3_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_window4_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_window5_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s8_window6_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest

  s7_window1_type:
    options: 
      - window_top
      - window_low
  s7_window2_type:
    options: 
      - window_top
      - window_low
  s7_window3_type:
    options: 
      - window_top
      - window_low
  s7_window4_type:
    options: 
      - window_top
      - window_low
  s7_window5_type:
    options: 
      - window_top
      - window_low
  s7_window6_type:
    options: 
      - window_top
      - window_low
  s7_window7_type:
    options: 
      - window_top
      - window_low
  s7_window8_type:
    options: 
      - window_top
      - window_low
  s7_window9_type:
    options: 
      - window_top
      - window_low
  s7_window10_type:
    options: 
      - window_top
      - window_low                    
  s7_window1_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window2_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window3_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window4_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window5_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window6_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window7_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window8_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest      
  s7_window9_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest
  s7_window10_orientation:
    options:
      - Nord
      - Nord Est
      - Est
      - Sud Est
      - Sud
      - Sud Ovest
      - Ovest
      - Nord Ovest


##### input boolean entities 
input_boolean:
  kafka_integration:
    name: "Kafka integration"
    initial: true
  s7_period_1:
    name: "Periodo 1"
  s7_period_2:
    name: "Periodo 2"
  s7_period_3:
    name: "Periodo 3"
  s7_period_4:
    name: "Periodo 4"
  s8_period_1:
    name: "Periodo 1"
  s8_period_2:
    name: "Periodo 2"
  s8_period_3:
    name: "Periodo 3"
  s8_period_4:
    name: "Periodo 4"
  s7_window_top_automation:
    name: "Automazioni colmi Serra 7"
  s7_window_low_automation:
    name: "Automazioni finestre laterali Serra 7"
  s8_window_top_automation:
    name: "Automazioni colmi Serra 8"
  s8_window_low_automation:  
    name: "Automazioni finestre laterali Serra 8"
  s8_window1_active:
    name: "In funzione"
  s8_window2_active:
    name: "In funzione"
  s8_window3_active:
    name: "In funzione"
  s8_window4_active:
    name: "In funzione"
  s8_window5_active:
    name: "In funzione"
  s8_window6_active:  
    name: "In funzione"
  
  s7_window1_active:
    name: "In funzione"
  s7_window2_active:
    name: "In funzione"
  s7_window3_active:
    name: "In funzione"
  s7_window4_active:
    name: "In funzione"
  s7_window5_active:
    name: "In funzione"
  s7_window6_active:  
    name: "In funzione"  
  s7_window7_active:  
    name: "In funzione"
  s7_window8_active:  
    name: "In funzione"
  s7_window9_active:  
    name: "In funzione"
  s7_window10_active:  
    name: "In funzione"

  #kairosgreen nodes group
  # platform: group
  # name: Stazioni Rilevamento S8
  # device_class: connectivity
  # entities:
  #   - binary_sensor.kgnode_agrfut_s8_01


sensor:
  #######################################
  ######### Weather Station #############
  #######################################
  - name: ws_temperature
    platform: mqtt
    state_topic: ws/temperature
    device_class: temperature
    unit_of_measurement: "°c"
  - name: ws_humidity
    platform: mqtt
    state_topic: ws/humidity
    unit_of_measurement: "%"
  - name: ws_battery
    platform: mqtt
    unique_id: ws_battery
    state_topic: ws/battery
    device_class: battery
  - name: ws_uv_sensor
    platform: mqtt
    state_topic: ws/uv
  - name: ws_wind_direction_sensor
    platform: mqtt
    state_topic: ws/wind/direction
  - name: ws_wind_speed_sensor
    platform: mqtt
    state_topic: ws/wind/speed
  - name: ws_wind_gust_sensor #folata
    platform: mqtt
    state_topic: ws/wind/gust 
  - name: ws_rain_sensor
    platform: mqtt
    state_topic: ws/rain
  - name: ws_solar_radiation_sensor
    platform: mqtt
    state_topic: ws/solar-radiation
  #######################################
  ############# Serra 7 #################
  #######################################
  # temperatura / umidità
  - platform: mqtt #s7_humidity_sensor 
    name: s7_humidity_sensor #TODO: DA rivedere nomi
    state_topic: "shellies/XXXXXXX/ext_humidity/0"
    device_class: humidity
  - platform: mqtt #s7_temperature_sensor
    name: s7_temperature_sensor #TODO: DA rivedere nomi
    state_topic: "shellies/s7Sensor2/ext_temperature/0"
    device_class: temperature
  - platform: mqtt #s7Soilmoisture_sensor
    name: s7Soilmoisture_sensor #TODO: DA rivedere nomi
    state_topic: "YYYYYYY/ext_temperature/0"
    device_class: humidity
  #######################################
  ############# Serra 8 #################
  #######################################
  # temperatura / umidità
  - name: s8_humidity_sensor
    platform: mqtt
    state_topic: "dummy_topic"
    device_class: humidity
  - name: s8_temperature_sensor
    device_class: temperature
    platform: mqtt
    state_topic: "dummy_topic"
  - name: s8_hic_sensor
    device_class: temperature
    platform: mqtt
    state_topic: "dummy_topic"
  - name: s8_soilmoisture_sensor 
    platform: mqtt
    state_topic: "dummy_topic"
    device_class: humidity 
  - name: s8_soiltemperature_sensor 
    device_class: temperature
    platform: mqtt
    state_topic: "dummy_topic"
  - name: s8_soilec_sensor 
    device_class: temperature 
    platform: mqtt
    state_topic: "dummy_topic"
  # sensor template
  - platform: template #TODO: DA rivedere range di valori
    sensors:
      #######################################
      ############# Serra 7 #################
      #######################################
      frontend_s7_window_left_side1:
          friendly_name: "Laterale SX "
          unique_id: frontend_s7_window_left_side1
          value_template: "{{ states('input_number.s7_window1_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_right_side1:
          friendly_name: "Laterale DX"
          unique_id: frontend_s7_window_right_side1
          value_template: "{{ states('input_number.s7_window2_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_front_sea_side_lx1:
          friendly_name: "Frontale SX Mare"
          unique_id: frontend_s7_window_front_sea_side_lx1
          value_template: "{{ states('input_number.s7_window3_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_front_sea_side_rx1:
          friendly_name: "Frontale DX Mare"
          unique_id: frontend_s7_window_front_sea_side_rx1
          value_template: "{{ states('input_number.s7_window4_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_front_mountain_side_lx1:
          friendly_name: "Frontale SX Monte"
          unique_id: frontend_s7_window_front_mountain_side_lx1
          value_template: "{{ states('input_number.s7_window5_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_front_mountain_side_rx1:
          friendly_name: "Frontale DX Monte"
          unique_id: frontend_s7_window_front_mountain_side_rx1
          value_template: "{{ states('input_number.s7_window6_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent"
      frontend_s7_window_top1:
          friendly_name: "Colmo 1"
          unique_id: frontend_s7_window_top1
          value_template: "{{ states('input_number.s7_window7_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_top2:
          friendly_name: "Colmo 2"
          unique_id: frontend_s7_window_top2
          value_template: "{{ states('input_number.s7_window8_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_top3:
          friendly_name: "Colmo 4"
          unique_id: frontend_s7_window_top3
          value_template: "{{ states('input_number.s7_window9_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s7_window_top4:
          friendly_name: "Colmo 3"
          unique_id: frontend_s7_window_top4
          value_template: "{{ states('input_number.s7_window10_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      s7_temperature: #sensori per media di altri sensori
        friendly_name: "Temperatura Serra 7"
        value_template: "{{ states('sensor.s7_temperature_sensor') }}"
        unit_of_measurement: "°c"
      s7_humidity: #sensori per media di altri sensori
        friendly_name: "Umidità Serra 7"
        value_template: "{{ states('sensor.s7_humidity_sensor')|int }}" 
        unit_of_measurement: "%"        
      s7_soilmoisture_sensor: #sensori per media di altri sensori
        friendly_name: "Umidità del terreno"
        value_template: "{{ states('sensor.s7Soilmoisture_sensor')|int }}" #TODO: rivedere nome
        unit_of_measurement: "°c"
      s7_temperature_trend:
        friendly_name: "Trend temperatura (30 min)"
        value_template: >-
          {% if is_state('binary_sensor.s7_temp_falling', 'off') and  is_state('binary_sensor.s7_temp_rising', 'off') %}
            BALANCED
          {% elif is_state('binary_sensor.s7_temp_falling', 'on') and  is_state('binary_sensor.s7_temp_rising', 'off') %}
            FALLING
          {% elif is_state('binary_sensor.s7_temp_falling', 'off') and is_state('binary_sensor.s7_temp_rising', 'on') %}
            RISING
          {% endif %}
      #######################################
      ############# Serra 8 #################
      #######################################
      frontend_s8_window_front_sea_side1:
          friendly_name: "Frontale lato Mare"
          unique_id: frontend_s8_window_front_sea_side1
          value_template: "{{ states('input_number.s8_window1_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s8_window_front_mountain_side1:
          friendly_name: "Frontale lato Monte"
          unique_id: frontend_s8_window_front_mountain_side1
          value_template: "{{ states('input_number.s8_window2_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s8_window_right_side1:
          friendly_name: "Laterale DX"
          unique_id: frontend_s8_window_right_side1
          value_template: "{{ states('input_number.s8_window3_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s8_window_left_side1:
          friendly_name: "Laterale SX"
          unique_id: frontend_s8_window_left_side1
          value_template: "{{ states('input_number.s8_window4_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s8_window_top1:
          friendly_name: "Colmo 1"
          unique_id: frontend_s8_window_top1
          value_template: "{{ states('input_number.s8_window5_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      frontend_s8_window_top2:
          friendly_name: "Colmo 2"
          unique_id: frontend_s8_window_top2
          value_template: "{{ states('input_number.s8_window6_position')|int }}"
          unit_of_measurement: "%"
          icon_template: mdi:percent
      s8_temperature: #sensori per media di altri sensori
        friendly_name: "Temperatura Serra 8"
        value_template: "{{ states('sensor.s8_temperature_sensor') }}"
        unit_of_measurement: "°c"
      s8_humidity: #sensori per media di altri sensori
        friendly_name: "Umidità Serra 8"
        value_template: "{{ states('sensor.s8_humidity_sensor')|int }}" #TODO: rivedere nome
        unit_of_measurement: "%"      
      s8_hic: #temperatura percepita
        friendly_name: "Temperatura Percepita"
        value_template: "{{ states('sensor.s8_hic_sensor') }}" #TODO: rivedere nome
        unit_of_measurement: "°c"
      s8_soil_moisture: #sensori per media di altri sensori
        friendly_name: "Umidità del terreno"
        value_template: "{{ states('sensor.s8_soilmoisture_sensor')|int }}" #TODO: rivedere nome
        unit_of_measurement: "%"
      s8_soil_temperature: #sensori per media di altri sensori
        friendly_name: "Temperatura del terreno"
        value_template: "{{ states('sensor.s8_soiltemperature_sensor') }}" 
        unit_of_measurement: "°c"
      s8_soil_ec: #sensori per media di altri sensori
        friendly_name: "EC"
        value_template: "{{ states('sensor.sensor.s8_soilec_sensor') }}" 
        unit_of_measurement: "mS/cm"
      s8_temperature_trend:
        friendly_name: "Trend temperatura (30 min)"
        value_template: >-
          {% if is_state('binary_sensor.s8_temp_falling', 'off') and  is_state('binary_sensor.s8_temp_rising', 'off') %}
            BALANCED
          {% elif is_state('binary_sensor.s8_temp_falling', 'on') and  is_state('binary_sensor.s8_temp_rising', 'off') %}
            FALLING
          {% elif is_state('binary_sensor.s8_temp_falling', 'off') and is_state('binary_sensor.s8_temp_rising', 'on') %}
            RISING
          {% endif %}    
      w_wind_intensity_frontend:
        value_template: >
          {% if states('sensor.ws_wind_speed_sensor')|int > 0 %}
            {{ states('sensor.ws_wind_speed_sensor')|int }}
          {% else %}
            ASSENTE
          {% endif %}
      w_wind_direction_frontend:
        value_template: >
          {% if states('sensor.w_wind_intensity_frontend') == 'ASSENTE' %}
            ASSENTE
          {% else %}
            {% set winbearing = (states('sensor.ws_wind_direction_sensor')|float/45)|int|round %}
            {% set winddir = ['Nord', 'Nord Est','Est','Sud Est','Sud','Sud Ovest','Ovest','Nord Ovest'] %}
            {{ winddir[winbearing] }}
          {% endif %}
      w_wind_gust_frontend:
        value_template: >
          {% if states('sensor.w_wind_intensity_frontend') == 'ASSENTE' %}
            ASSENTE
          {% else %}
            {{ states('sensor.ws_wind_gust_sensor')|int }}
          {% endif %}
      w_rain_intensity_frontend: #TODO: sistemare con parametro ambientale
        value_template: >
          {% if states('sensor.ws_rain_sensor')|float == 0 %} 
            ASSENTE
          {% elif states('sensor.ws_rain_sensor')|float <= 10 %}
            PIOGGIA DEBOLE
          {% else %}
            TEMPORALE
          {% endif %}     
      weather_index:
        value_template: >
          {% if states('sensor.ws_rain_sensor')|float > 0 and states('sensor.ws_rain_sensor')|float <= 10 %}
            PIOGGIA DEBOLE
          {% elif states('sensor.ws_rain_sensor')|float > 10 %}
            TEMPORALE
          {% elif states('sensor.ws_solar_radiation_sensor')|int == 0 %}
            NOTTE
          {% elif states('sensor.ws_solar_radiation_sensor')|int > 0 and states('sensor.ws_solar_radiation_sensor')|int < 150 %}
            NUVOLOSO
          {% elif states('sensor.ws_solar_radiation_sensor')|int > 0 and states('sensor.ws_solar_radiation_sensor')|int > 150 %}
            SOLEGGIATO
          {% endif %}
      w_rain_state:
        value_template: >
          {% if states('sensor.weather_index') == 'PIOGGIA DEBOLE' or states('sensor.weather_index') == 'TEMPORALE'  %}
            WE_RAINING
          {% else %}
            WE_NOT_RAINING
          {% endif %}
      w_wind_direction: 
        value_template: >
          {% if states('sensor.w_wind_direction_frontend') == ASSENTE %}
            WE_WIND_NONE
          {% else %}
            {{ states('sensor.w_wind_direction_frontend') }}
          {% endif %}
      w_wind_intensity_state:
        value_template: >
          {% if states('sensor.ws_wind_speed_sensor') == 'unknown' or (states('sensor.ws_wind_speed_sensor')|int >= 0 and states('sensor.ws_wind_speed_sensor')|int < states('input_number.w_wind_level1')|int) %}
            WE_WIND_INTENSITY_NONE
          {% elif states('sensor.ws_wind_speed_sensor')|int >= states('input_number.w_wind_level1')|int and states('sensor.ws_wind_speed_sensor')|int < states('input_number.w_wind_level2')|int %}
            WE_WIND_INTENSITY_MODERATE
          {% elif states('sensor.ws_wind_speed_sensor')|int >= states('input_number.w_wind_level2')|int %}
            WE_WIND_INTENSITY_HIGH
          {% endif %}
      w_temperature_state:
        value_template: >-
          {% if states('sensor.temperature_sensor')|int < 5 %}
            extremely_cold
          {% elif states('sensor.temperature_sensor')|int > 5 and states('sensor.temperature_sensor')|int <= 10 %}
            cold
          {% elif states('sensor.temperature_sensor')|int > 11 and states('sensor.temperature_sensor')|int <= 20 %}
            normal
          {% elif states('sensor.temperature_sensor')|int > 20 and states('sensor.temperature_sensor')|int <= 30 %}
            hot
          {% else %}
            extremely_hot
          {% endif %}

binary_sensor:
  #kairosgreen gateway
  - name: kt_gateway_000001
    platform: mqtt
    state_topic: "kairostech/nodes/kt_gateway_000001/online"
    payload_on: "on"
    payload_on: "off"
    device_class: connectivity
  #kairosgreen nodes
  - name: kt_node_000001
    platform: mqtt
    state_topic: "kairostech/nodes/kt_node_000001/online"
    payload_on: "on"
    payload_on: "off"
    device_class: connectivity
  #S7
  - platform: mqtt #s7_blackout
    name: s7_blackout  
    unique_id: s7_blackout
    state_topic: "shellies/s7Sensor1/input/0"
    qos: 0
    payload_on: "1"
    payload_off: "0"
  - platform: mqtt #s7_window_side_anomaly
    name: s7_window_side_anomaly  
    state_topic: "shellies/s7Sensor1/input/2"
    qos: 0
    payload_on: "1"
    payload_off: "0"
  - platform: mqtt #s7_window_top_anomaly
    name: s7_window_top_anomaly  
    state_topic: "shellies/s7Sensor1/input/1"
    qos: 0
    payload_on: "1"
    payload_off: "0"
  #S8  
  - platform: mqtt #s8_blackout
    name: s8_blackout  #TODO: Da rivedere nomi e topic
    state_topic: "shellies/kairos_anomalia/input/1"
    qos: 0
    payload_on: "1"
    payload_off: "0"
  - platform: mqtt #s8_window_side_anomaly
    name: s8_window_side_anomaly  #TODO: Da rivedere nomi e topic
    state_topic: "shellies/kairos_anomalia/input/1"
    qos: 0
    payload_on: "1"
    payload_off: "0"
  - platform: mqtt #s8_window_top_anomaly
    name: s8_window_top_anomaly  #TODO: Da rivedere nomi e topic
    state_topic: "shellies/kairos_anomalia/input/1"
    qos: 0
    payload_on: "1"
    payload_off: "0"
  - platform: template
    sensors:
      s7_state:
        friendly_name: Serra 7
        device_class: problem
        value_template: >
          {% if states('binary_sensor.s7_blackout') == 'on' or states('binary_sensor.s7_window_side_anomaly') == 'on' or states('binary_sensor.s7_window_top_anomaly') == 'on' %}
            on
          {% else %}
            off
          {% endif %}
      s8_state:
        friendly_name: Serra 8
        device_class: problem
        value_template: >
          {% if states('binary_sensor.s8_blackout') == 'on' or states('binary_sensor.s8_window_side_anomaly') == 'on' or states('binary_sensor.s8_window_top_anomaly') == 'on' %}
            on
          {% else %}
            off
          {% endif %}
      s7_windows_top_open:
        value_template: >
          {% if is_state("sensor.frontend_s7_window_top1", "0") and is_state("sensor.frontend_s7_window_top2", "0") and is_state("sensor.frontend_s7_window_top3", "0") and is_state("sensor.frontend_s7_window_top4", "0")  %}
            false
          {% else %}
            true
          {% endif %}
      s8_windows_top_open:
        value_template: >
          {% if is_state("sensor.frontend_s8_window_top1", "0") and is_state("sensor.frontend_s8_window_top2", "0") %}
            false
          {% else %}
            true
          {% endif %}
  - platform: trend
    sensors:
      s7_temp_falling:
        entity_id: sensor.s7_temperature_sensor
        sample_duration: 1800
        max_samples: 60
        min_gradient: -0.0002
        device_class: cold
      s7_temp_rising:
        entity_id: sensor.s7_temperature_sensor
        sample_duration: 1800
        max_samples: 60
        min_gradient: 0.0002
        device_class: heat
      s8_temp_falling:
        entity_id: sensor.s8_temperature_sensor
        sample_duration: 1800
        max_samples: 60
        min_gradient: -0.0002
        device_class: cold
      s8_temp_rising:
        entity_id: sensor.s8_temperature_sensor
        sample_duration: 1800
        max_samples: 60
        min_gradient: 0.0002
        device_class: heat
  - platform: group
    name: Stazioni Rilevamento S8
    device_class: connectivity
    entities:
      - binary_sensor.kt_node_000001
cover:
  - platform: mqtt #s7WindowLeftSide1
    unique_id: s7_window_left_side1
    name: "Laterale SX"
    command_topic: "shellies/s7WindowLeftSide1/roller/0/command"
    position_topic: "shellies/s7WindowLeftSide1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowLeftSide1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowLeftSide1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
  - platform: mqtt #s7_window_right_side1
    unique_id: s7_window_right_side1
    name: "Laterale DX"
    command_topic: "shellies/s7WindowRightSide1/roller/0/command"
    # position_topic: "shellies/s7WindowRightSide1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowRightSide1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowRightSide1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_front_sea_side_lx1
    unique_id: s7_window_front_sea_side_lx1
    name: "Frontale SX Mare"
    command_topic: "shellies/s7WindowFrontSeaSideLx1/roller/0/command"
    # position_topic: "shellies/s7WindowFrontSeaSideLx1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowFrontSeaSideLx1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowFrontSeaSideLx1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_front_sea_side_rx1
    unique_id: s7_window_front_sea_side_rx1
    name: "Frontale DX Mare"
    command_topic: "shellies/s7WindowFrontSeaSideRx1/roller/0/command"
    # position_topic: "shellies/s7WindowFrontSeaSideRx1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowFrontSeaSideRx1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowFrontSeaSideRx1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_front_mountain_side_lx1
    unique_id: s7_window_front_mountain_side_lx1
    name: "Frontale SX Monte"
    command_topic: "shellies/s7WindowFrontMountainSideLx1/roller/0/command"
    # position_topic: "shellies/s7WindowFrontMountainSideLx1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowFrontMountainSideLx1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowFrontMountainSideLx1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_front_mountain_side_rx1
    unique_id: s7_window_front_mountain_side_rx1
    name: "Frontale DX Monte"
    command_topic: "shellies/s7WindowFrontMountainSideRx1/roller/0/command"
    # position_topic: "shellies/s7WindowFrontMountainSideRx1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowFrontMountainSideRx1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowFrontMountainSideRx1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_top1
    unique_id: s7_window_top1
    name: "Colmo 1"
    command_topic: "shellies/s7WindowTop1/roller/0/command"
    # position_topic: "shellies/s7WindowTop1/roller/0/pos"
    #set_position_topic: "shellies/s7WindowTop1/roller/0/command/pos"
    availability_topic: "shellies/s7WindowTop1/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_top2
    unique_id: s7_window_top2
    name: "Colmo 2"
    command_topic: "shellies/s7WindowTop2/roller/0/command"
    #position_topic: "shellies/s7WindowTop2/roller/0/pos"
    #set_position_topic: "shellies/s7WindowTop2/roller/0/command/pos"
    availability_topic: "shellies/s7WindowTop2/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_top3
    unique_id: s7_window_top3
    name: "Colmo 4"
    command_topic: "shellies/s7WindowTop3/roller/0/command"
    #position_topic: "shellies/s7WindowTop3/roller/0/pos"
    #set_position_topic: "shellies/s7WindowTop3/roller/0/command/pos"
    availability_topic: "shellies/s7WindowTop3/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1
  - platform: mqtt #s7_window_top4
    unique_id: s7_window_top4
    name: "Colmo 3"
    command_topic: "shellies/s7WindowTop4/roller/0/command"
    #position_topic: "shellies/s7WindowTop4/roller/0/pos"
    #set_position_topic: "shellies/s7WindowTop4/roller/0/command/pos"
    availability_topic: "shellies/s7WindowTop4/online"
    payload_available: "true"
    payload_not_available: "false"
    retain: false
    payload_open: "open"
    payload_close: "close"
    payload_stop: "stop"
    position_open: 100
    position_closed: 0
    optimistic: false
    qos: 1

#### hassio groups
#### use kakfa_entity_align groups for add all the entities you whant to include in the kafka align's procedure
group:
  # kafka_entity_align:
  #   name: "Kafka entity group"
  #   entities:
  # 
  s7_periods_active:
    name: "Periodi Attivi serra 7"
    entities:
      - input_boolean.s7_period_1
      - input_boolean.s7_period_2
      - input_boolean.s7_period_3
      - input_boolean.s7_period_4
  s7_periods:
    name: "Periodi Serra 7"
    entities:
      - input_datetime.s7_period_1
      - input_datetime.s7_period_2
      - input_datetime.s7_period_3
      - input_datetime.s7_period_4
  s7_period_temperature:
    name: "Temperature periodi Serra 7"
    entities:
      - input_number.s7_temperature_period_1
      - input_number.s7_temperature_period_2
      - input_number.s7_temperature_period_3
      - input_number.s7_temperature_period_4
  s7_period_window_top_max_open:
    name: "Massima apertura colmi Serra 7"
    entities:
      - input_number.s7_window_top_max_open_period_1
      - input_number.s7_window_top_max_open_period_2
      - input_number.s7_window_top_max_open_period_3
      - input_number.s7_window_top_max_open_period_4
  s7_period_window_low_max_open:
    name: "Massima apertura finestre laterali Serra 7"
    entities:
      - input_number.s7_window_low_max_open_period_1
      - input_number.s7_window_low_max_open_period_2
      - input_number.s7_window_low_max_open_period_3
      - input_number.s7_window_low_max_open_period_4
  windows_greenhouse7:
    name: "Serra 7 - Finestre"
    entities:
      - input_text.s7_window1
      - input_text.s7_window2
      - input_text.s7_window3
      - input_text.s7_window4
      - input_text.s7_window5
      - input_text.s7_window6
      - input_text.s7_window7
      - input_text.s7_window8
      - input_text.s7_window9
      - input_text.s7_window10
  # wind upwind / downwind groups
  s7_period_wind_downwind_moderate_window_top_max_open:
    name: "Massima apertura a sottovento moderato colmi Serra 7"
    entities:
      - input_number.s7_window_top_max_open_period_1_downwind_moderate
      - input_number.s7_window_top_max_open_period_2_downwind_moderate
      - input_number.s7_window_top_max_open_period_3_downwind_moderate
      - input_number.s7_window_top_max_open_period_4_downwind_moderate
  s7_period_wind_downwind_moderate_window_low_max_open:
    name: "Massima apertura a sottovento moderato finestre laterali Serra 7"
    entities:
      - input_number.s7_window_low_max_open_period_1_downwind_moderate
      - input_number.s7_window_low_max_open_period_2_downwind_moderate
      - input_number.s7_window_low_max_open_period_3_downwind_moderate
      - input_number.s7_window_low_max_open_period_4_downwind_moderate
  s7_period_wind_downwind_strong_window_top_max_open:
    name: "Massima apertura a sottovento intenso colmi Serra 7"
    entities:
      - input_number.s7_window_top_max_open_period_1_downwind_strong
      - input_number.s7_window_top_max_open_period_2_downwind_strong
      - input_number.s7_window_top_max_open_period_3_downwind_strong
      - input_number.s7_window_top_max_open_period_4_downwind_strong
  s7_period_wind_downwind_strong_window_low_max_open:
    name: "Massima apertura a sottovento intenso finestre laterali Serra 7"
    entities:
      - input_number.s7_window_low_max_open_period_1_downwind_strong
      - input_number.s7_window_low_max_open_period_2_downwind_strong
      - input_number.s7_window_low_max_open_period_3_downwind_strong
      - input_number.s7_window_low_max_open_period_4_downwind_strong  
  s7_period_wind_upwind_moderate_window_top_max_open:
    name: "Massima apertura a controvento moderato colmi Serra 7"
    entities:
      - input_number.s7_window_top_max_open_period_1_upwind_moderate
      - input_number.s7_window_top_max_open_period_2_upwind_moderate
      - input_number.s7_window_top_max_open_period_3_upwind_moderate
      - input_number.s7_window_top_max_open_period_4_upwind_moderate
  s7_period_wind_upwind_strong_window_top_max_open:
    name: "Massima apertura a controvento intenso colmi Serra 7"
    entities:
      - input_number.s7_window_top_max_open_period_1_upwind_strong
      - input_number.s7_window_top_max_open_period_2_upwind_strong
      - input_number.s7_window_top_max_open_period_3_upwind_strong
      - input_number.s7_window_top_max_open_period_4_upwind_strong
  ###################################################
  ############# Serra 8 #############################
  ###################################################
  s8_periods_active:
    name: "Periodi Attivi serra 8"
    entities:
      - input_boolean.s8_period_1
      - input_boolean.s8_period_2
      - input_boolean.s8_period_3
      - input_boolean.s8_period_4
  s8_periods:
    name: "Periodi Serra 8"
    entities:
      - input_datetime.s8_period_1
      - input_datetime.s8_period_2
      - input_datetime.s8_period_3
      - input_datetime.s8_period_4
  s8_period_temperature:
    name: "Temperature periodi Serra 8"
    entities:
      - input_number.s8_temperature_period_1
      - input_number.s8_temperature_period_2
      - input_number.s8_temperature_period_3
      - input_number.s8_temperature_period_4
  s8_period_window_top_max_open:
    name: "Massima apertura colmi Serra 8"
    entities:
      - input_number.s8_window_top_max_open_period_1
      - input_number.s8_window_top_max_open_period_2
      - input_number.s8_window_top_max_open_period_3
      - input_number.s8_window_top_max_open_period_4
  s8_period_window_low_max_open:
    name: "Massima apertura finestre laterali Serra 8"
    entities:
      - input_number.s8_window_low_max_open_period_1
      - input_number.s8_window_low_max_open_period_2
      - input_number.s8_window_low_max_open_period_3
      - input_number.s8_window_low_max_open_period_4
  windows_greenhouse8:
    name: "Serra 8 - Finestre"
    entities:
      - input_text.s8_window1
      - input_text.s8_window2
      - input_text.s8_window3
      - input_text.s8_window4
      - input_text.s8_window5
      - input_text.s8_window6

  # wind upwind / downwind groups
  s8_period_wind_downwind_moderate_window_top_max_open:
    name: "Massima apertura a sottovento moderato colmi Serra 7"
    entities:
      - input_number.s8_window_top_max_open_period_1_downwind_moderate
      - input_number.s8_window_top_max_open_period_2_downwind_moderate
      - input_number.s8_window_top_max_open_period_3_downwind_moderate
      - input_number.s8_window_top_max_open_period_4_downwind_moderate
  s8_period_wind_downwind_moderate_window_low_max_open:
    name: "Massima apertura a sottovento moderato finestre laterali Serra 7"
    entities:
      - input_number.s8_window_low_max_open_period_1_downwind_moderate
      - input_number.s8_window_low_max_open_period_2_downwind_moderate
      - input_number.s8_window_low_max_open_period_3_downwind_moderate
      - input_number.s8_window_low_max_open_period_4_downwind_moderate
  s8_period_wind_downwind_strong_window_top_max_open:
    name: "Massima apertura a sottovento intenso colmi Serra 7"
    entities:
      - input_number.s8_window_top_max_open_period_1_downwind_strong
      - input_number.s8_window_top_max_open_period_2_downwind_strong
      - input_number.s8_window_top_max_open_period_3_downwind_strong
      - input_number.s8_window_top_max_open_period_4_downwind_strong
  s8_period_wind_downwind_strong_window_low_max_open:
    name: "Massima apertura a sottovento intenso finestre laterali Serra 7"
    entities:
      - input_number.s8_window_low_max_open_period_1_downwind_strong
      - input_number.s8_window_low_max_open_period_2_downwind_strong
      - input_number.s8_window_low_max_open_period_3_downwind_strong
      - input_number.s8_window_low_max_open_period_4_downwind_strong  
  s8_period_wind_upwind_moderate_window_top_max_open:
    name: "Massima apertura a controvento moderato colmi Serra 7"
    entities:
      - input_number.s8_window_top_max_open_period_1_upwind_moderate
      - input_number.s8_window_top_max_open_period_2_upwind_moderate
      - input_number.s8_window_top_max_open_period_3_upwind_moderate
      - input_number.s8_window_top_max_open_period_4_upwind_moderate
  s8_period_wind_upwind_strong_window_top_max_open:
    name: "Massima apertura a controvento intenso colmi Serra 7"
    entities:
      - input_number.s8_window_top_max_open_period_1_upwind_strong
      - input_number.s8_window_top_max_open_period_2_upwind_strong
      - input_number.s8_window_top_max_open_period_3_upwind_strong
      - input_number.s8_window_top_max_open_period_4_upwind_strong
  ###################################################

#### include kairos core automations
automation kairos: !include_dir_merge_list hakairos-configuration/automations/

#### automations
automation:
  #Automazioni su temperatura 
  - alias: Alert temperatura ambiente
    trigger:
      - platform: state
        entity_id: sensor.w_temperature_state
        to: cold
        for: "00:01:00"
      - platform: state
        entity_id: sensor.w_temperature_state
        to: extremely_cold
        for: "00:01:00"
      - platform: state
        entity_id: sensor.w_temperature_state
        to: extremely_hot
        for: "00:01:00"
    action:
      - event: HA_EVENT
        event_data:
          target: sensor.w_temperature_state
          threshold: "{{ trigger.to_state.state }}"
  - alias: Alert anomalia serra 7 ON
    trigger:
      - platform: state
        entity_id: binary_sensor.s7_state
        to: "on"
        for: "00:01:00"
    action:
      - event: HA_EVENT
        event_data:
          target: binary_sensor.s7_state
          threshold: > 
            {% if states('binary_sensor.s7_blackout')%}
              blackout
            {% elif states('binary_sensor.s7_window_side_anomaly') %}
              windows_side_anomaly
            {% elif states('binary_sensor.s7_window_top_anomaly') %}
              windows_top_anomaly
            {% endif %}
      - service: service.turn_off
        entity_id: input_boolean.s7_window_low_automation
      - service: service.turn_off
        entity_id: input_boolean.s7_window_top_automation
  - alias: Alert anomalia serra 8 ON
    trigger:
      - platform: state
        entity_id: binary_sensor.s8_state
        to: on
        for: "00:01:00"
    action:
      - event: HA_EVENT
        event_data:
          target: binary_sensor.s8_state
          threshold: > 
            {% if states('binary_sensor.s8_blackout')%}
              blackout
            {% elif states('binary_sensor.s8_window_side_anomaly') %}
              windows_side_anomaly
            {% elif states('binary_sensor.s8_window_top_anomaly') %}
              windows_top_anomaly
            {% endif %}
      - service: service.turn_off
        entity_id: input_boolean.s8_window_low_automation
      - service: service.turn_off
        entity_id: input_boolean.s8_window_top_automation
  - alias: Alert anomalia serra 7 OFF
    trigger:
      - platform: state
        entity_id: binary_sensor.s7_state
        to: off
        for: "00:01:00"
    action:
      - event: HA_EVENT
        event_data:
          target: binary_sensor.s7_state
          threshold: off
      - service: service.turn_on
        entity_id: input_boolean.s7_window_low_automation
      - service: service.turn_on
        entity_id: input_boolean.s7_window_top_automation
  - alias: Alert anomalia serra 8 OFF
    trigger:
      - platform: state
        entity_id: binary_sensor.s8_state
        to: off
        for: "00:01:00"
    action:
      - event: HA_EVENT
        event_data:
          target: binary_sensor.s8_state
          threshold: off
      - service: service.turn_on
        entity_id: input_boolean.s8_window_low_automation
      - service: service.turn_on
        entity_id: input_boolean.s8_window_top_automation
  
#Automazioni su eventi ambientali

################################################
################################################
###     Automazione pioggia
################################################
################################################
  - alias: Alert pioggia
    trigger:
      - platform: state
        entity_id: sensor.w_rain_state
        to: WE_RAINING
        for: "00:00:10"
    action:
      - event: HA_EVENT
        event_data:
          target: sensor.w_rain_state
          threshold: WE_RAINING
      - event: HA_MANAGE_WINDOWS3
        event_data: 
          event: "raining"
          periodActive: group.s7_periods_active
          period: group.s7_periods
          periodTemperature: group.s7_period_temperature
          periodWindowTopMaxOpen: group.s7_period_window_top_max_open
          periodWindowLowMaxOpen: group.s7_period_window_low_max_open
          rainingSensor: "{{states('sensor.w_rain_state')}}"
          structure_orientation:
            downwind: "{{ states('input_select.s7_downwind') }}"
            upwind: "{{ states('input_select.s7_upwind') }}"
          periodWindWindowTopMaxOpen: 
            downwind: 
              moderate: group.s7_period_wind_downwind_moderate_window_top_max_open
              strong: group.s7_period_wind_downwind_strong_window_top_max_open
            upwind: 
              moderate: group.s7_period_wind_upwind_moderate_window_top_max_open
              strong: group.s7_period_wind_upwind_strong_window_top_max_open
          periodWindWindowLowMaxOpen:
            downwind: 
              moderate: group.s7_period_wind_downwind_moderate_window_low_max_open
              strong: group.s7_period_wind_downwind_strong_window_low_max_open
          entities: group.windows_greenhouse7
          openCloseTime: 
            window_top: "{{states('input_number.s7_open_close_time_window_top')|int}}"
            window_low: "{{states('input_number.s7_open_close_time_window_low')|int}}" 
      - event: HA_MANAGE_WINDOWS3
        event_data: 
          event: "raining"
          periodActive: group.s8_periods_active
          period: group.s8_periods
          periodTemperature: group.s8_period_temperature
          periodWindowTopMaxOpen: group.s8_period_window_top_max_open
          periodWindowLowMaxOpen: group.s8_period_window_low_max_open
          rainingSensor: "{{states('sensor.w_rain_state')}}"
          structure_orientation:
            downwind: "{{ states('input_select.s8_downwind') }}"
            upwind: "{{ states('input_select.s8_upwind') }}"
          periodWindWindowTopMaxOpen: 
            downwind: 
              moderate: group.s8_period_wind_downwind_moderate_window_top_max_open
              strong: group.s8_period_wind_downwind_strong_window_top_max_open
            upwind: 
              moderate: group.s8_period_wind_upwind_moderate_window_top_max_open
              strong: group.s8_period_wind_upwind_strong_window_top_max_open
          periodWindWindowLowMaxOpen:
            downwind: 
              moderate: group.s8_period_wind_downwind_moderate_window_low_max_open
              strong: group.s8_period_wind_downwind_strong_window_low_max_open
          entities: group.windows_greenhouse8
          openCloseTime: 
            window_top: "{{states('input_number.s8_open_close_time_window_top')|int}}"
            window_low: "{{states('input_number.s8_open_close_time_window_low')|int}}"
  - alias: Alert Pioggia - Conferma chiusura S7
    trigger:
      - platform: state
        entity_id: binary_sensor.s7_windows_top_open
        to: "off"
    condition: 
      - condition: state
        entity_id: "sensor.w_rain_state"
        state: "WE_RAINING"
    action:
      - event: HA_EVENT
        event_data:
          target: binary_sensor.s7_windows_top_open
          threshold: "off"
  - alias: Alert Pioggia - Conferma chiusura S8
    trigger:
      - platform: state
        entity_id: binary_sensor.s8_windows_top_open
        to: "off"
    condition: 
      - condition: state
        entity_id: "sensor.w_rain_state"
        state: "WE_RAINING"
    action:
      - event: HA_EVENT
        event_data:
          target: binary_sensor.s8_windows_top_open
          threshold: "off"

################################################
################################################
###     Automazione Vento
################################################
################################################
  - alias: Vento 
    trigger:
      - platform: state
        entity_id: sensor.w_wind_intensity_state
        # from: WE_WIND_INTENSITY_NONE
        to: WE_WIND_INTENSITY_MODERATE
        for: "00:01:00"
      - platform: state
        entity_id: sensor.w_wind_intensity_state
        # from: WE_WIND_INTENSITY_MODERATE
        to: WE_WIND_INTENSITY_HIGH
        for: "00:01:00"
    action:
      - event: HA_MANAGE_WINDOWS3
        event_data: 
          event: "wind"
          periodActive: group.s7_periods_active
          period: group.s7_periods
          periodTemperature: group.s7_period_temperature
          periodWindowTopMaxOpen: group.s7_period_window_top_max_open
          periodWindowLowMaxOpen: group.s7_period_window_low_max_open
          #valueToCheck: "{{states('sensor.s7_temperature')}}"
          rainingSensor: "{{states('sensor.w_rain_state')}}"
          windSensor: "{{states('sensor.w_wind_intensity_state')}}"
          windDirectionSensor: "{{states('sensor.w_wind_direction')}}"
          structure_orientation:
            downwind: "{{ states('input_select.s7_downwind') }}"
            upwind: "{{ states('input_select.s7_upwind') }}"
          periodWindWindowTopMaxOpen: 
            downwind: 
              moderate: group.s7_period_wind_downwind_moderate_window_top_max_open
              strong: group.s7_period_wind_downwind_strong_window_top_max_open
            upwind: 
              moderate: group.s7_period_wind_upwind_moderate_window_top_max_open
              strong: group.s7_period_wind_upwind_strong_window_top_max_open
          periodWindWindowLowMaxOpen:
            downwind: 
              moderate: group.s7_period_wind_downwind_moderate_window_low_max_open
              strong: group.s7_period_wind_downwind_strong_window_low_max_open
          entities: group.windows_greenhouse7
          openCloseTime: 
            window_top: "{{states('input_number.s7_open_close_time_window_top')|int}}"
            window_low: "{{states('input_number.s7_open_close_time_window_low')|int}}" 
      - event: HA_MANAGE_WINDOWS3
        event_data: 
          event: "wind"
          periodActive: group.s8_periods_active
          period: group.s8_periods
          periodTemperature: group.s8_period_temperature
          periodWindowTopMaxOpen: group.s8_period_window_top_max_open
          periodWindowLowMaxOpen: group.s8_period_window_low_max_open
          #valueToCheck: "{{states('sensor.s8_temperature')}}"
          rainingSensor: "{{states('sensor.w_rain_state')}}"
          windSensor: "{{states('sensor.w_wind_intensity_state')}}"
          windDirectionSensor: "{{states('sensor.w_wind_direction')}}"
          structure_orientation:
            downwind: "{{ states('input_select.s8_downwind') }}"
            upwind: "{{ states('input_select.s8_upwind') }}"
          periodWindWindowTopMaxOpen: 
            downwind: 
              moderate: group.s8_period_wind_downwind_moderate_window_top_max_open
              strong: group.s8_period_wind_downwind_strong_window_top_max_open
            upwind: 
              moderate: group.s8_period_wind_upwind_moderate_window_top_max_open
              strong: group.s8_period_wind_upwind_strong_window_top_max_open
          periodWindWindowLowMaxOpen:
            downwind: 
              moderate: group.s8_period_wind_downwind_moderate_window_low_max_open
              strong: group.s8_period_wind_downwind_strong_window_low_max_open
          entities: group.windows_greenhouse8
          openCloseTime: 
            window_top: "{{states('input_number.s8_open_close_time_window_top')|int}}"
            window_low: "{{states('input_number.s8_open_close_time_window_low')|int}}"    
 

################################################
################################################
###     Automazione su tempo
################################################
################################################ 
  - alias: Serra 7-8 Gestione finestre / periodi
    trigger: 
      - platform: time_pattern
        minutes: /1
    condition:
      - condition: template
        value_template: >
          {{ now().minute % states('input_number.windows_automation_frequency')|int == 0}}
    action:
      - event: HA_MANAGE_WINDOWS3
        event_data: 
          event: "windows_check"
          periodActive: group.s7_periods_active
          period: group.s7_periods
          periodTemperature: group.s7_period_temperature
          temperatureTrend: "{{states('sensor.s7_temperature_trend')}}"
          periodWindowTopMaxOpen: group.s7_period_window_top_max_open
          periodWindowLowMaxOpen: group.s7_period_window_low_max_open
          valueToCheck: "{{states('sensor.s7_temperature')}}"
          rainingSensor: "{{states('sensor.w_rain_state')}}"
          windSensor: "{{states('sensor.w_wind_intensity_state')}}"
          windDirectionSensor: "{{states('sensor.w_wind_direction')}}"
          structure_orientation:
            downwind: "{{ states('input_select.s7_downwind') }}"
            upwind: "{{ states('input_select.s7_upwind') }}"
          periodWindWindowTopMaxOpen: 
            downwind: 
              moderate: group.s7_period_wind_downwind_moderate_window_top_max_open
              strong: group.s7_period_wind_downwind_strong_window_top_max_open
            upwind: 
              moderate: group.s7_period_wind_upwind_moderate_window_top_max_open
              strong: group.s7_period_wind_upwind_strong_window_top_max_open
          periodWindWindowLowMaxOpen:
            downwind: 
              moderate: group.s7_period_wind_downwind_moderate_window_low_max_open
              strong: group.s7_period_wind_downwind_strong_window_low_max_open
          windowsMinStep:
            window_top: "{{states('input_number.s7_open_close_step_window_top')|int}}"
            window_low: "{{states('input_number.s7_open_close_step_window_low')|int}}"
          entities: group.windows_greenhouse7
          openCloseTime: 
            window_top: "{{states('input_number.s7_open_close_time_window_top')|int}}"
            window_low: "{{states('input_number.s7_open_close_time_window_low')|int}}" 
      - event: HA_MANAGE_WINDOWS3
        event_data: 
          event: "windows_check"
          periodActive: group.s8_periods_active
          period: group.s8_periods
          periodTemperature: group.s8_period_temperature
          temperatureTrend: "{{states('sensor.s8_temperature_trend')}}"
          periodWindowTopMaxOpen: group.s8_period_window_top_max_open
          periodWindowLowMaxOpen: group.s8_period_window_low_max_open
          valueToCheck: "{{states('sensor.s8_temperature')}}"
          rainingSensor: "{{states('sensor.w_rain_state')}}"
          windSensor: "{{states('sensor.w_wind_intensity_state')}}"
          windDirectionSensor: "{{states('sensor.w_wind_direction')}}"
          structure_orientation:
            downwind: "{{ states('input_select.s8_downwind') }}"
            upwind: "{{ states('input_select.s8_upwind') }}"
          periodWindWindowTopMaxOpen: 
            downwind: 
              moderate: group.s8_period_wind_downwind_moderate_window_top_max_open
              strong: group.s8_period_wind_downwind_strong_window_top_max_open
            upwind: 
              moderate: group.s8_period_wind_upwind_moderate_window_top_max_open
              strong: group.s8_period_wind_upwind_strong_window_top_max_open
          periodWindWindowLowMaxOpen:
            downwind: 
              moderate: group.s8_period_wind_downwind_moderate_window_low_max_open
              strong: group.s8_period_wind_downwind_strong_window_low_max_open
          windowsMinStep:
            window_top: "{{states('input_number.s8_open_close_step_window_top')|int}}"
            window_low: "{{states('input_number.s8_open_close_step_window_low')|int}}"
          entities: group.windows_greenhouse8
          openCloseTime: 
            window_top: "{{states('input_number.s8_open_close_time_window_top')|int}}"
            window_low: "{{states('input_number.s8_open_close_time_window_low')|int}}"

  #Automazioni sulle finestre
  - alias: Chiudi tutte le finestre
    trigger:
      - platform: event
        event_type: HA_CLOSE_WINDOWS
      - platform: event
        event_type: HA_CLOSE_WINDOWS_DUE_RAIN
    action: #script chiusura finestre  
      - event: HA_MANAGE_WINDOWS
        event_data:  
          event: "{{ trigger.event.event_type }}"
          entities:
            - sensor.s7_window_left_side1
            - sensor.s7_window_front_sea_side_lx1
            - sensor.s7_window_front_sea_side_rx1
            - sensor.s7_window_right_side1
            - sensor.s7_window_front_mountain_side_lx1
            - sensor.s7_window_front_mountain_side_rx1
            - sensor.s7_window_top1
            - sensor.s7_window_top2
            - sensor.s7_window_top3
            - sensor.s7_window_top4
#            - group.windows_greenhouse8
          toPosition: 0
          openCloseTime: "{{states('input_number.s7_open_close_time_window_top')|int}}"
          #positionIncrease:
          #positionDecrease:
  - alias: Riposiziona tutte le finestre
    trigger:
      - platform: event
        event_type: HA_WINDOWS_RESET_POSITION 
      - platform: event
        event_type: HA_STOPPED_RAINING
    action:
      - service: mqtt.publish
        data:
          topic: "shellies/s7Sensor2/ext_temperature/0"
          payload: "reset"
           
  #automazioni sulla stazione meteo
  - alias: Leggi dati da stazione meteo
    trigger:
      - platform: time_pattern
        seconds: "30"
    action:
      - event: HA_MANAGE_WEATHERSTATION

  #automazione messaggi kairosgreen node
  - alias: Leggi dati da stazioni Rilevamento
    trigger: 
      - platform: mqtt
        topic: "kairostech/nodes/data"
    action:
      - event: APPDAEMON_KGNODE_MQTT_INTERNAL_MESSAGE
        event_data:
          payload: "{{ trigger.payload }}"
      
#### logger configuration
logger:
  default: info
  logs:
    homeassistant.components.cloud: debug
    custom_components.hakafka: info
    custom_components.ha-custom-events: info

# shell_command:
#   entity_metrics: "python3 ./hakairos-configuration/scripts/entityMetrics.py"
#   system_metrics: "python3 ./hakairos-configuration/scripts/systemMetrics.py"
